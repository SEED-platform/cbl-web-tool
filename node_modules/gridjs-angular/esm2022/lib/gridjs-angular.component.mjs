import { Component, ElementRef, EventEmitter, Input, Output, ViewEncapsulation, } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Grid } from 'gridjs';
import { GRID_JS_EVENTS, GRID_JS_PROPS } from './constants';
import * as i0 from "@angular/core";
export class GridJsAngularComponent {
    constructor(elementDef) {
        this.elementDef = elementDef;
        this.initialized = false;
        this.listeners = new Map();
        // props
        this.plugins = [];
        // events
        this.beforeLoad = new EventEmitter(true);
        // renamed load event to avoid conflict with native load event
        this.gridLoad = new EventEmitter(true);
        this.cellClick = new EventEmitter(true);
        this.rowClick = new EventEmitter(true);
        this.ready = new EventEmitter(true);
        this.nativeElement = this.elementDef.nativeElement;
    }
    ngAfterViewInit() {
        this.instance = new Grid(this.getConfig(this.config ?? {}));
        this.registerEvents();
        this.instance.render(this.nativeElement);
        this.initialized = true;
    }
    ngOnChanges() {
        if (this.initialized) {
            this.updateConfig(this.config);
        }
    }
    ngOnDestroy() {
        if (this.initialized) {
            if (this.instance) {
                this.unregisterEvents();
                this.instance = undefined;
            }
        }
    }
    // public api to interact with grid instance
    getGridInstance() {
        return this.instance;
    }
    updateConfig(config = {}) {
        this.instance?.updateConfig(this.getConfig(config)).forceRender();
    }
    registerEvents() {
        for (const event of GRID_JS_EVENTS) {
            const emitter = event === 'load' ? this.gridLoad : this[event];
            if (!emitter) {
                continue;
            }
            const listener = (args) => emitter.emit(args);
            this.listeners.set(event, listener);
            if (emitter) {
                this.instance?.on(event, listener);
            }
        }
    }
    unregisterEvents() {
        for (const [event, listener] of this.listeners.entries()) {
            this.instance?.off(event, listener);
        }
    }
    getConfig(config = {}) {
        const newConfig = structuredClone(config);
        for (const [key, value] of Object.entries(this)) {
            if (GRID_JS_PROPS.includes(key)) {
                newConfig[key] = value;
            }
        }
        this.config = newConfig;
        return newConfig;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: GridJsAngularComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.1", type: GridJsAngularComponent, isStandalone: true, selector: "gridjs-angular", inputs: { config: "config", plugins: "plugins", eventEmitter: "eventEmitter", plugin: "plugin", data: "data", server: "server", header: "header", from: "from", storage: "storage", pipeline: "pipeline", autoWidth: "autoWidth", width: "width", height: "height", translator: "translator", style: "style", className: "className", fixedHeader: "fixedHeader", columns: "columns", search: "search", pagination: "pagination", sort: "sort", language: "language", resizable: "resizable", processingThrottleMs: "processingThrottleMs" }, outputs: { beforeLoad: "beforeLoad", gridLoad: "gridLoad", cellClick: "cellClick", rowClick: "rowClick", ready: "ready" }, usesOnChanges: true, ngImport: i0, template: '', isInline: true, dependencies: [{ kind: "ngmodule", type: CommonModule }], encapsulation: i0.ViewEncapsulation.None }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: GridJsAngularComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'gridjs-angular',
                    template: '',
                    standalone: true,
                    imports: [CommonModule],
                    encapsulation: ViewEncapsulation.None,
                }]
        }], ctorParameters: () => [{ type: i0.ElementRef }], propDecorators: { config: [{
                type: Input
            }], plugins: [{
                type: Input
            }], eventEmitter: [{
                type: Input
            }], plugin: [{
                type: Input
            }], data: [{
                type: Input
            }], server: [{
                type: Input
            }], header: [{
                type: Input
            }], from: [{
                type: Input
            }], storage: [{
                type: Input
            }], pipeline: [{
                type: Input
            }], autoWidth: [{
                type: Input
            }], width: [{
                type: Input
            }], height: [{
                type: Input
            }], translator: [{
                type: Input
            }], style: [{
                type: Input
            }], className: [{
                type: Input
            }], fixedHeader: [{
                type: Input
            }], columns: [{
                type: Input
            }], search: [{
                type: Input
            }], pagination: [{
                type: Input
            }], sort: [{
                type: Input
            }], language: [{
                type: Input
            }], resizable: [{
                type: Input
            }], processingThrottleMs: [{
                type: Input
            }], beforeLoad: [{
                type: Output
            }], gridLoad: [{
                type: Output
            }], cellClick: [{
                type: Output
            }], rowClick: [{
                type: Output
            }], ready: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZGpzLWFuZ3VsYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvZ3JpZGpzLWFuZ3VsYXIvc3JjL2xpYi9ncmlkanMtYW5ndWxhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEVBQ04saUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQVUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDOztBQXNCNUQsTUFBTSxPQUFPLHNCQUFzQjtJQWlEakMsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQTVDbEMsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFDcEIsY0FBUyxHQUEwQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBR3JELFFBQVE7UUFDQyxZQUFPLEdBQXNCLEVBQUUsQ0FBQztRQXdCekMsU0FBUztRQUNDLGVBQVUsR0FDbEIsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsOERBQThEO1FBQ3BELGFBQVEsR0FBd0MsSUFBSSxZQUFZLENBQ3hFLElBQUksQ0FDTCxDQUFDO1FBQ1EsY0FBUyxHQUNqQixJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNmLGFBQVEsR0FDaEIsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDZixVQUFLLEdBQXlDLElBQUksWUFBWSxDQUN0RSxJQUFJLENBQ0wsQ0FBQztRQUdBLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUM7SUFDckQsQ0FB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QVBsQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxnQkFBZ0I7b0JBQzFCLFFBQVEsRUFBRSxFQUFFO29CQUNaLFVBQVUsRUFBRSxJQUFJO29CQUNoQixPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ3ZCLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2lCQUN0QzsrRUFRVSxNQUFNO3NCQUFkLEtBQUs7Z0JBR0csT0FBTztzQkFBZixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLElBQUk7c0JBQVosS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLElBQUk7c0JBQVosS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLG9CQUFvQjtzQkFBNUIsS0FBSztnQkFHSSxVQUFVO3NCQUFuQixNQUFNO2dCQUdHLFFBQVE7c0JBQWpCLE1BQU07Z0JBR0csU0FBUztzQkFBbEIsTUFBTTtnQkFFRyxRQUFRO3NCQUFqQixNQUFNO2dCQUVHLEtBQUs7c0JBQWQsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbmZpZywgR3JpZCB9IGZyb20gJ2dyaWRqcyc7XG5pbXBvcnQgeyBHUklEX0pTX0VWRU5UUywgR1JJRF9KU19QUk9QUyB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IEdyaWRFdmVudHMgfSBmcm9tICdncmlkanMvZGlzdC9zcmMvZXZlbnRzJztcblxudHlwZSBHcmlkSnNBbmd1bGFyQ29tcG9uZW50UHJvcHMgPSBPbWl0PFxuICBQYXJ0aWFsPENvbmZpZz4sXG4gICdpbnN0YW5jZScgfCAnc3RvcmUnIHwgJ2Fzc2lnbicgfCAndXBkYXRlJ1xuPjtcbnR5cGUgR3JpZEV2ZW50ID0ga2V5b2YgR3JpZEV2ZW50cztcbnR5cGUgR3JpZEV2ZW50RGF0YTxUIGV4dGVuZHMgR3JpZEV2ZW50PiA9IFBhcmFtZXRlcnM8XG4gIEdyaWRFdmVudHNbVF1cbj5bMF0gZXh0ZW5kcyB1bmRlZmluZWRcbiAgPyB2b2lkXG4gIDogUGFyYW1ldGVyczxHcmlkRXZlbnRzW1RdPlswXTtcblxudHlwZSBBbnlGbiA9ICguLi5hcmdzOiBhbnlbXSkgPT4gYW55O1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZ3JpZGpzLWFuZ3VsYXInLFxuICB0ZW1wbGF0ZTogJycsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtDb21tb25Nb2R1bGVdLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxufSlcbmV4cG9ydCBjbGFzcyBHcmlkSnNBbmd1bGFyQ29tcG9uZW50XG4gIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIEdyaWRKc0FuZ3VsYXJDb21wb25lbnRQcm9wc1xue1xuICBwcml2YXRlIG5hdGl2ZUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGluc3RhbmNlPzogR3JpZDtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlO1xuICBwcml2YXRlIGxpc3RlbmVyczogTWFwPEdyaWRFdmVudCwgQW55Rm4+ID0gbmV3IE1hcCgpO1xuICBASW5wdXQoKSBjb25maWc/OiBQYXJ0aWFsPENvbmZpZz47XG5cbiAgLy8gcHJvcHNcbiAgQElucHV0KCkgcGx1Z2luczogQ29uZmlnWydwbHVnaW5zJ10gPSBbXTtcbiAgQElucHV0KCkgZXZlbnRFbWl0dGVyPzogQ29uZmlnWydldmVudEVtaXR0ZXInXTtcbiAgQElucHV0KCkgcGx1Z2luPzogQ29uZmlnWydwbHVnaW4nXTtcbiAgQElucHV0KCkgZGF0YTogQ29uZmlnWydkYXRhJ107XG4gIEBJbnB1dCgpIHNlcnZlcjogQ29uZmlnWydzZXJ2ZXInXTtcbiAgQElucHV0KCkgaGVhZGVyOiBDb25maWdbJ2hlYWRlciddO1xuICBASW5wdXQoKSBmcm9tPzogQ29uZmlnWydmcm9tJ107XG4gIEBJbnB1dCgpIHN0b3JhZ2U/OiBDb25maWdbJ3N0b3JhZ2UnXTtcbiAgQElucHV0KCkgcGlwZWxpbmU/OiBDb25maWdbJ3BpcGVsaW5lJ107XG4gIEBJbnB1dCgpIGF1dG9XaWR0aD86IENvbmZpZ1snYXV0b1dpZHRoJ107XG4gIEBJbnB1dCgpIHdpZHRoPzogQ29uZmlnWyd3aWR0aCddO1xuICBASW5wdXQoKSBoZWlnaHQ/OiBDb25maWdbJ2hlaWdodCddO1xuICBASW5wdXQoKSB0cmFuc2xhdG9yPzogQ29uZmlnWyd0cmFuc2xhdG9yJ107XG4gIEBJbnB1dCgpIHN0eWxlOiBDb25maWdbJ3N0eWxlJ107XG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogQ29uZmlnWydjbGFzc05hbWUnXTtcbiAgQElucHV0KCkgZml4ZWRIZWFkZXI/OiBDb25maWdbJ2ZpeGVkSGVhZGVyJ107XG4gIEBJbnB1dCgpIGNvbHVtbnM/OiBDb25maWdbJ2NvbHVtbnMnXTtcbiAgQElucHV0KCkgc2VhcmNoPzogQ29uZmlnWydzZWFyY2gnXTtcbiAgQElucHV0KCkgcGFnaW5hdGlvbj86IENvbmZpZ1sncGFnaW5hdGlvbiddO1xuICBASW5wdXQoKSBzb3J0PzogQ29uZmlnWydzb3J0J107XG4gIEBJbnB1dCgpIGxhbmd1YWdlPzogQ29uZmlnWydsYW5ndWFnZSddO1xuICBASW5wdXQoKSByZXNpemFibGU/OiBDb25maWdbJ3Jlc2l6YWJsZSddO1xuICBASW5wdXQoKSBwcm9jZXNzaW5nVGhyb3R0bGVNcz86IENvbmZpZ1sncHJvY2Vzc2luZ1Rocm90dGxlTXMnXTtcblxuICAvLyBldmVudHNcbiAgQE91dHB1dCgpIGJlZm9yZUxvYWQ6IEV2ZW50RW1pdHRlcjxHcmlkRXZlbnREYXRhPCdiZWZvcmVMb2FkJz4+ID1cbiAgICBuZXcgRXZlbnRFbWl0dGVyKHRydWUpO1xuICAvLyByZW5hbWVkIGxvYWQgZXZlbnQgdG8gYXZvaWQgY29uZmxpY3Qgd2l0aCBuYXRpdmUgbG9hZCBldmVudFxuICBAT3V0cHV0KCkgZ3JpZExvYWQ6IEV2ZW50RW1pdHRlcjxHcmlkRXZlbnREYXRhPCdsb2FkJz4+ID0gbmV3IEV2ZW50RW1pdHRlcihcbiAgICB0cnVlLFxuICApO1xuICBAT3V0cHV0KCkgY2VsbENsaWNrOiBFdmVudEVtaXR0ZXI8R3JpZEV2ZW50RGF0YTwnY2VsbENsaWNrJz4+ID1cbiAgICBuZXcgRXZlbnRFbWl0dGVyKHRydWUpO1xuICBAT3V0cHV0KCkgcm93Q2xpY2s6IEV2ZW50RW1pdHRlcjxHcmlkRXZlbnREYXRhPCdyb3dDbGljayc+PiA9XG4gICAgbmV3IEV2ZW50RW1pdHRlcih0cnVlKTtcbiAgQE91dHB1dCgpIHJlYWR5OiBFdmVudEVtaXR0ZXI8R3JpZEV2ZW50RGF0YTwncmVhZHknPj4gPSBuZXcgRXZlbnRFbWl0dGVyKFxuICAgIHRydWUsXG4gICk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50RGVmOiBFbGVtZW50UmVmKSB7XG4gICAgdGhpcy5uYXRpdmVFbGVtZW50ID0gdGhpcy5lbGVtZW50RGVmLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBHcmlkKHRoaXMuZ2V0Q29uZmlnKHRoaXMuY29uZmlnID8/IHt9KSk7XG4gICAgdGhpcy5yZWdpc3RlckV2ZW50cygpO1xuICAgIHRoaXMuaW5zdGFuY2UucmVuZGVyKHRoaXMubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhpcy51cGRhdGVDb25maWcodGhpcy5jb25maWcpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgICB0aGlzLnVucmVnaXN0ZXJFdmVudHMoKTtcbiAgICAgICAgdGhpcy5pbnN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gcHVibGljIGFwaSB0byBpbnRlcmFjdCB3aXRoIGdyaWQgaW5zdGFuY2VcbiAgZ2V0R3JpZEluc3RhbmNlKCkge1xuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICB9XG5cbiAgdXBkYXRlQ29uZmlnKGNvbmZpZzogUGFydGlhbDxDb25maWc+ID0ge30pIHtcbiAgICB0aGlzLmluc3RhbmNlPy51cGRhdGVDb25maWcodGhpcy5nZXRDb25maWcoY29uZmlnKSkuZm9yY2VSZW5kZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJFdmVudHMoKSB7XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBHUklEX0pTX0VWRU5UUykge1xuICAgICAgY29uc3QgZW1pdHRlciA9IGV2ZW50ID09PSAnbG9hZCcgPyB0aGlzLmdyaWRMb2FkIDogdGhpc1tldmVudF07XG4gICAgICBpZiAoIWVtaXR0ZXIpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBsaXN0ZW5lcjogQW55Rm4gPSAoYXJncykgPT4gZW1pdHRlci5lbWl0KGFyZ3MpO1xuICAgICAgdGhpcy5saXN0ZW5lcnMuc2V0KGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgICBpZiAoZW1pdHRlcikge1xuICAgICAgICB0aGlzLmluc3RhbmNlPy5vbihldmVudCwgbGlzdGVuZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdW5yZWdpc3RlckV2ZW50cygpIHtcbiAgICBmb3IgKGNvbnN0IFtldmVudCwgbGlzdGVuZXJdIG9mIHRoaXMubGlzdGVuZXJzLmVudHJpZXMoKSkge1xuICAgICAgdGhpcy5pbnN0YW5jZT8ub2ZmKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb25maWcoY29uZmlnOiBQYXJ0aWFsPENvbmZpZz4gPSB7fSkge1xuICAgIGNvbnN0IG5ld0NvbmZpZzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSBzdHJ1Y3R1cmVkQ2xvbmUoY29uZmlnKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh0aGlzKSkge1xuICAgICAgaWYgKEdSSURfSlNfUFJPUFMuaW5jbHVkZXMoa2V5IGFzIGtleW9mIENvbmZpZykpIHtcbiAgICAgICAgbmV3Q29uZmlnW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5jb25maWcgPSBuZXdDb25maWc7XG4gICAgcmV0dXJuIG5ld0NvbmZpZztcbiAgfVxufVxuIl19